{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='login.css') }}" />
<div class="register-container">
  <h2>Register</h2>
  <form action="#" id="registerForm" method="post">
    <div class="form-group">
      <label for="username">Username:</label>
      <input
        type="text"
        id="username"
        name="username"
        class="form-control"
        required
      />
    </div>
    <div class="form-group">
      <label for="password">Password:</label>
      <input
        type="password"
        id="password"
        name="password"
        class="form-control"
        required
      />
    </div>
    <div class="form-group">
      <label for="email">Email:</label>
      <input
        type="email"
        id="email"
        name="email"
        class="form-control"
        required
      />
    </div>
    <div class="form-group">
      <label for="name">Name:</label>
      <input
        type="text"
        id="name"
        name="name"
        class="form-control"
        required
      />
    </div>
    <div class="form-group">
      <label for="phone">Phone:</label>
      <input
        type="tel"
        id="phone"
        name="phone"
        class="form-control"
        required
      />
    </div>
    <div class="form-group">
      <label for="is_doctor">Are you a doctor?</label>
      <input
        type="checkbox"
        id="is_doctor"
        name="is_doctor"
        class="form-control"
      />
    </div>
    <button type="submit" class="btn btn-primary">Register</button>
  </form>
  <p>
    Already have an account? <a href="{{ url_for('auth.login') }}">Login</a>
  </p>
</div>
{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.getElementById('registerForm');
    registerForm.addEventListener('submit', async function(event) {
      event.preventDefault();

      const formData = new FormData(registerForm);
      const data = {
        username: formData.get('username'),
        password: formData.get('password'),
        email: formData.get('email'),
        name: formData.get('name'),
        phone: formData.get('phone'),
        is_doctor: formData.get('is_doctor') === 'on'
      };

      try {
        const response = await fetch('http://127.0.0.1/auth/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          const result = await response.json();
          alert(result.message);
          window.location.href = '{{ url_for("auth.login") }}';
        } else {
          const error = await response.json();
          alert(error.message);
        }
      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while registering. Please try again.');
      }
    });
  });
</script>
{% endblock %}
{% endblock %}